<?xml version="1.0" ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2003/01/wi">
	<Product Id="79D9BD6E-E954-490C-B8C4-CC713D74CA3F" UpgradeCode="C1781722-8046-4A2A-8419-5CBC9616220C"
		Name="Wipt" Language="1033" Version="$(var.ProductVersion)" Manufacturer="ACM@UIUC">
		<Package Id="????????-????-????-????-????????????" Description="Windows Installer Package Tool" 
      Comments="Copyright (c) 2006 ACM@UIUC.  See the LICENSE file for copying details."
			InstallerVersion="200" Compressed="yes" />
		<Binary Id="MSVBDPCADLL" SourceFile="InstallUtil\MSVBDPCADLL.ibd" />
    <Binary Id="VSDNETCFG" SourceFile="InstallUtil\VSDNETCFG.ibd" />
		<Media Id="1" Cabinet="Product.cab" EmbedCab="yes" />
    <UIRef Id="WixUI_InstallDir" />
    <CustomAction Id="SetTargetDir" Property="TARGETDIR" Value="[ProgramFilesFolder]" />
    <WixVariable Id="WixUILicenseRtf" Value="C:\Users\mloar2\Documents\Projects\Wipt\LICENSE.rtf" />
		<Directory Id="TARGETDIR" Name="SourceDir">
				<Directory Id="ACMDir" Name="ACM">
					<Directory Id="INSTALLDIR" Name="Wipt">
						<Component Id="SystemInstallerComponent" Guid="D3315C16-FD47-48FD-B15D-0711FCEF603A">
							<File Id="ACMWiptWindowsInstaller.dllFile" Name="ACM.Wipt.WindowsInstaller.dll" DiskId="1" 
                Source="System.Installer\ACM.Wipt.WindowsInstaller.dll" Vital="yes" KeyPath="yes" Assembly=".net" />
						</Component>
						<Component Id="WiptLibComponent" Guid="083477F3-A07D-490C-B17F-25EF6DBC7C79">
							<File Id="WiptLib.dllFile" Name="WIPTLIB.DLL" DiskId="1" Source="WiptLib\WiptLib.dll" Vital="yes" 
                KeyPath="yes" Assembly=".net" />
						</Component>
						<Component Id="WiptgetComponent" Guid="8C9ECEB5-A540-4700-9DED-E29B13582AD7">
							<File Id="wiptget.exeFile" Name="WIPT-GET.EXE" DiskId="1" Source="wipt-get\wipt-get.exe" Vital="yes" 
                KeyPath="yes" />
							<File Id="LicenseFile" Name="LICENSE.txt" DiskId="1" Source="LICENSE" />
							<Environment Id="UpdatePath" Name="PATH" Action="set" System="yes" Part="last" Value="[INSTALLDIR]" />
              <RegistryKey Root="HKLM" Key="SOFTWARE\ACM\Wipt" Action="create" />
              <RemoveRegistryKey Root="HKLM" Key="SOFTWARE\ACM\Wipt" Action="removeOnUninstall" />
              <RegistryValue Root="HKLM" Key="SOFTWARE\ACM\Wipt" Name="Repositories" 
                Value="https://www-s.acm.uiuc.edu/sigwin/wipt/packages.xml" Type="string" />
              <RemoveFile Id="DataFile" On="uninstall" Name="library.dat" Property="WiptDataDir" />
              <CreateFolder Directory="WiptDataDir">
                <Permission User="Administrators" GenericAll="yes" />
                <Permission User="Users" GenericRead="yes" GenericExecute="yes" ReadPermission="yes"
                  ReadExtendedAttributes="yes" />
              </CreateFolder>
              <RemoveFolder Id="WiptDataDirRemove" On="uninstall" Property="WiptDataDir" />
              <CreateFolder Directory="ACMDataDir">
                <Permission User="Administrators" GenericAll="yes" />
                <Permission User="Users" GenericRead="yes" GenericExecute="yes" ReadPermission="yes"
                  ReadExtendedAttributes="yes" />
              </CreateFolder>
              <RemoveFolder Id="ACMDataDirRemove" On="uninstall" Property="ACMDataDir" />
						</Component>
            <Component Id="WiptputComponent" Guid="5B435D09-9998-49B6-9606-278EB53AC1D8">
              <File Id="wiptput.exeFile" Name="WIPT-PUT.EXE" DiskId="1" Source="wipt-put\wipt-put.exe" Vital="yes"
                KeyPath="yes" />
            </Component>
            <!--<Component Id="WiptguiComponent" Guid="B4FCF30E-409C-45D4-81AE-CB41F0B88BF7">
							<File Id="wiptgui.exeFile" Name="WIPT-GUI.EXE" DiskId="1" Source="wipt-gui\wipt-gui.exe" Vital="yes" 
                KeyPath="yes" />
            </Component>-->
				</Directory>
			</Directory>
      <Directory Id="CommonAppDataFolder">
        <Directory Id="ACMDataDir" Name="ACM">
          <Directory Id="WiptDataDir" Name="Wipt" />
        </Directory>
      </Directory>
		</Directory>
		<Feature Id="DefaultFeature" Title="Default Install" Level="1">
			<ComponentRef Id="WiptgetComponent" />
      <ComponentRef Id="WiptputComponent" />
      <!--<ComponentRef Id="WiptguiComponent" />-->
			<ComponentRef Id="SystemInstallerComponent" />
      <ComponentRef Id="WiptLibComponent" />
		</Feature>
	  <Property Id="PREVIOUSVERSIONSINSTALLED" Secure="yes" />
		<Property Id="NEWERPRODUCTFOUND" Secure="yes" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
		<Upgrade Id="C1781722-8046-4A2A-8419-5CBC9616220C">
			<UpgradeVersion Minimum="$(var.ProductVersion)" Property="NEWERPRODUCTFOUND" OnlyDetect="yes" IncludeMinimum="yes" />
			<UpgradeVersion Minimum="1.0.0" Maximum="$(var.ProductVersion)" Property="PREVIOUSVERSIONSINSTALLED" IncludeMinimum="yes" />
		</Upgrade>
		<CustomAction Id="SetPrereqs" BinaryKey="MSVBDPCADLL" DllEntry="CheckFX" />
		<InstallExecuteSequence>
			<Custom Action="SetPrereqs" Before="AppSearch" />
      <Custom Action="SetTargetDir" Before="CostFinalize" />
      <MigrateFeatureStates />
      <RemoveExistingProducts After="InstallFinalize" />
		</InstallExecuteSequence>
    <InstallUISequence>
      <Custom Action="SetTargetDir" Before="CostFinalize" />
    </InstallUISequence>
	</Product>
</Wix>
